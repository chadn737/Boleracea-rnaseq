setwd("projects/The-molecular-basis-of-kale-domestication-Comparative-transcriptomics/")
setwd("figures_tables/")
source("../scripts/deg.R")
#Plot out data for specific genes of interest
#Create output directory
path <- "Genes_of_interest/"
if(!dir.exists(path)){
dir.create(path)
}
#Read in gene list
goi <- read.csv("../misc/genes_of_interest.csv",header=TRUE)
#Iterate over each gene in that list
for(gene in goi$Gene){
#Use "tryCatch" to handle errors
tryCatch({
#Make a table of that gene's data from deseq2 using the plotCounts function
x <- plotCounts(dds,gene,intgroup="condition",normalized=TRUE,transform=FALSE,
returnData=TRUE)
#Plot using ggplot2
p <- ggplot(x) +
geom_point(aes(x=condition,y= count,color=condition)) +
theme(panel.background=element_blank(),
axis.line=element_line(color="black"),
axis.text=element_text(color="black"),
axis.title=element_text(color="black",face="bold"),
legend.position="none") + xlab("Genotype")
#Save as a pdf
ggsave(paste(path,gene,"_counts.pdf",sep=""),p,width=5,height=4)
#How to handle potential errors
},error=function(e){})
}
#Plots for GOI of different functions
for(i in c('Development','Defense','Nutrition','Flowering')){
#Subset expression data
x <- geneEx[geneEx$Gene %in% goi[goi$Function==i & goi$Heatmap=='',]$Gene,]
#Merge expression data with goi info
x <- merge(x,goi[goi$Function==i & goi$Heatmap=='',],by.x='Gene',by.y='Gene')
#Set rownames to combination of B. oleracea gene ID & At homolog name
row.names(x) <- paste(x$Gene,': ',x$Name,sep="")
#Reorder the data frame based on log2 fold change from increasing to decreasing
x <- x[order(x$KvT_log2FC,decreasing=TRUE),]
#Get number of rows Kale is higher expressed, use this to set gap in heatmap
gap <- nrow(x[x$KvT_log2FC > 0,])
#Lets make a heatmap
#Save as pdf
pdf(paste(path,i,'_heatmap.pdf',sep=''))
#Use pheatmap on log2 transformed data
#We add 0.01 to all the data to handle 0 values that otherwise get set to -Inf
pheatmap(log2(x[2:9]+0.01),
#Turn off clustering
cluster_rows=FALSE,cluster_cols=FALSE,
#Modify the sample labels
labels_col =gsub('_',' ',colnames(x[2:9])),
gaps_row=c(gap),)
dev.off()
}
#New Heatmaps
for(i in c('HM1','HM2')){
#Subset expression data
x <- geneEx[geneEx$Gene %in% goi[goi$Heatmap==i,]$Gene,]
#Merge expression data with goi info
x <- merge(x,goi[goi$Heatmap==i,],by.x='Gene',by.y='Gene')
#Set rownames to combination of B. oleracea gene ID & At homolog name
row.names(x) <- paste(x$Gene,': ',x$Name,sep="")
#Reorder the data frame based on log2 fold change from increasing to decreasing
x <- x[order(x$KvT_log2FC,decreasing=TRUE),]
#Get number of rows Kale is higher expressed, use this to set gap in heatmap
gap <- nrow(x[x$KvT_log2FC > 0,])
#Lets make a heatmap
#Save as pdf
pdf(paste(path,i,'_heatmap.pdf',sep=''))
#Use pheatmap on log2 transformed data
#We add 0.01 to all the data to handle 0 values that otherwise get set to -Inf
pheatmap(log2(x[2:9]+0.01),
#Turn off clustering
cluster_rows=FALSE,cluster_cols=FALSE,
#Modify the sample labels
labels_col=gsub('_',' ',colnames(x[2:9])),
gaps_row=c(gap),)
dev.off()
}
